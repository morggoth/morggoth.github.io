<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Collecting logs #  CloudWatch #   region scope fault tolerant durable push, not pull  Everything in CW logs is going to be stored in a log group
A log stream - entity, which records into particular log group
A log record - is a single record of some event
# log group operations aws logs create-log-group aws logs delete-log-group aws logs associate-kms-key # log stream operations aws logs create-log-stream aws logs delete-log-stream # log record operations aws logs put-log-events aws logs get-log-events aws logs get-log-record Intagration with another services #     service type of logs     CloudTrail itself logs   API Gateway Access/Execution logs   ECS Container logs   Lambda Execution logs   RDS DB logs   Systems Manager Run   EC2 App/OS logs    CloudTrail #   region scope audit log logs both success and failure works with different types of events:  management data insights   organizations support  # trail operations aws cloudtrail create-trail aws cloudtrail delete-trail # logging operations aws cloudtrail start-logging aws cloudtrail stop-logging # validation operations aws cloudtrail validate-logs Analyzing logs #  CloudWatch insights #   use existing log group/stream (sql-like) query engine alarm integration  # Create query aws logs put-query-definition aws logs delete-query-definition # execute query and get results aws logs start-query aws logs stop-query aws logs get-query CloudTrail insights #   use existing events ML-driven no query engine  aws cloudtrail put-insights-selectors aws cloudtrail get-insights-selectors ElasticSearch and Kibana #   region scope analytics engine reporting engine CWL integration  Exporting logs #  CWL export #   S3 export CLI tail subscription filter - automatically delivers logs from CW to tne another service:  kinesis stream lambda function kinesis data firehose logical destination    # create or delete export task aws logs create-export-task aws logs cancel-export-task # live tail of log stream aws logs tail # create new subscription filter aws logs put-subscription-filter --log-group-name --filter-name --filter-pattern --destination-arn --role-arn Kinesis data firehose #  This is a sort of batch mechanism"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Monitoring, logging and retention"><meta property="og:description" content="Collecting logs #  CloudWatch #   region scope fault tolerant durable push, not pull  Everything in CW logs is going to be stored in a log group
A log stream - entity, which records into particular log group
A log record - is a single record of some event
# log group operations aws logs create-log-group aws logs delete-log-group aws logs associate-kms-key # log stream operations aws logs create-log-stream aws logs delete-log-stream # log record operations aws logs put-log-events aws logs get-log-events aws logs get-log-record Intagration with another services #     service type of logs     CloudTrail itself logs   API Gateway Access/Execution logs   ECS Container logs   Lambda Execution logs   RDS DB logs   Systems Manager Run   EC2 App/OS logs    CloudTrail #   region scope audit log logs both success and failure works with different types of events:  management data insights   organizations support  # trail operations aws cloudtrail create-trail aws cloudtrail delete-trail # logging operations aws cloudtrail start-logging aws cloudtrail stop-logging # validation operations aws cloudtrail validate-logs Analyzing logs #  CloudWatch insights #   use existing log group/stream (sql-like) query engine alarm integration  # Create query aws logs put-query-definition aws logs delete-query-definition # execute query and get results aws logs start-query aws logs stop-query aws logs get-query CloudTrail insights #   use existing events ML-driven no query engine  aws cloudtrail put-insights-selectors aws cloudtrail get-insights-selectors ElasticSearch and Kibana #   region scope analytics engine reporting engine CWL integration  Exporting logs #  CWL export #   S3 export CLI tail subscription filter - automatically delivers logs from CW to tne another service:  kinesis stream lambda function kinesis data firehose logical destination    # create or delete export task aws logs create-export-task aws logs cancel-export-task # live tail of log stream aws logs tail # create new subscription filter aws logs put-subscription-filter --log-group-name --filter-name --filter-pattern --destination-arn --role-arn Kinesis data firehose #  This is a sort of batch mechanism"><meta property="og:type" content="article"><meta property="og:url" content="https://morggoth.github.io/docs/cloud/aws/monitoring_logging_and_retention/"><meta property="article:published_time" content="2021-08-17T00:43:09+03:00"><meta property="article:modified_time" content="2021-08-17T00:43:09+03:00"><title>Monitoring, logging and retention | Morggoth's wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/en.search.min.fa3efae274ce09bffb59cbff494710879fbe8b279eaca8b3e83ea50e45e2354f.js integrity="sha256-+j764nTOCb/7Wcv/SUcQh5++iyeerKiz6D6lDkXiNU8="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>Morggoth's wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/cloud/ class=collapsed>Cloud</a><ul><li><a href=/docs/cloud/aws/reliability_and_business_continuity/>Reliability and business continuity</a></li><li><a href=/docs/cloud/aws/monitoring_logging_and_retention/ class=active>Monitoring, logging and retention</a></li><li><a href=/docs/cloud/as-a-service/>As a Service schema</a></li><li><a href=/docs/cloud/serverless/>Serverless</a></li></ul></li><li><a href=/docs/k8s/ class=collapsed>Kubernetes</a></li><li><a href=/docs/mooc/ class=collapsed>Courses notes</a></li><li><a href=/docs/misc/prometheus/>Prometheus</a></li><li><a href=/docs/misc/docker/>Основы Docker</a></li><li><a href=/docs/misc/cheatsheets/>Cheatsheets</a></li><li><a href=/docs/misc/rpi/>Raspberry Pi</a></li><li><a href=/docs/misc/kafka/>Kafka basics</a></li><li><a href=/docs/misc/old_hardware/>Old hardware</a></li><li><a href=/docs/languages/ class=collapsed>Languages</a></li><li><a href=/docs/misc/chromeos/>ChromeOS</a></li><li><a href=/docs/misc/macos/>macOS</a></li><li><a href=/docs/misc/mikrotik/>Mikrotik</a></li><li><a href=/docs/misc/tips_and_tricks/>Tips & Tricks</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Monitoring, logging and retention</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#collecting-logs>Collecting logs</a><ul><li><a href=#cloudwatch>CloudWatch</a></li><li><a href=#intagration-with-another-services>Intagration with another services</a></li><li><a href=#cloudtrail>CloudTrail</a></li></ul></li><li><a href=#analyzing-logs>Analyzing logs</a><ul><li><a href=#cloudwatch-insights>CloudWatch insights</a></li><li><a href=#cloudtrail-insights>CloudTrail insights</a></li><li><a href=#elasticsearch-and-kibana>ElasticSearch and Kibana</a></li></ul></li><li><a href=#exporting-logs>Exporting logs</a><ul><li><a href=#cwl-export>CWL export</a></li><li><a href=#kinesis-data-firehose>Kinesis data firehose</a></li></ul></li><li><a href=#cloudwatch-alarm>CloudWatch Alarm</a><ul><li><a href=#terms>Terms</a></li><li><a href=#missing-data-points>Missing data points</a></li><li><a href=#other-alarms-options>Other alarms options</a></li><li><a href=#alarm-actions>alarm actions</a></li></ul></li><li><a href=#cloudwatch-metric-filters>CloudWatch Metric Filters</a><ul><li><a href=#string-metric-filters-basics>String Metric Filters basics</a></li><li><a href=#space-delimited-metric-filter-basics>Space-delimited metric filter basics</a></li><li><a href=#json-metric-filter-basics>JSON metric filter basics</a></li></ul></li><li><a href=#cloudwatch-dashboards>CloudWatch Dashboards</a></li><li><a href=#cloudwatch-alarm-remediation>CloudWatch alarm remediation</a><ul><li><a href=#ec2-actions>EC2 actions</a></li><li><a href=#autoscaling-actions>Autoscaling actions</a></li><li><a href=#manual-actions>Manual actions</a></li><li><a href=#automated-actions>Automated actions</a></li><li><a href=#ec2-status-checks>EC2 status checks</a></li><li><a href=#ebs-volume-status-checks>EBS volume status checks</a></li></ul></li><li><a href=#eventbridge-rules>EventBridge rules</a></li><li><a href=#config-rules-and-ssm-automation-documents>Config rules and SSM automation documents</a></li></ul></nav></aside></header><article class=markdown><h2 id=collecting-logs>Collecting logs
<a class=anchor href=#collecting-logs>#</a></h2><h3 id=cloudwatch>CloudWatch
<a class=anchor href=#cloudwatch>#</a></h3><ul><li>region scope</li><li>fault tolerant</li><li>durable</li><li>push, not pull</li></ul><p>Everything in CW logs is going to be stored in a <em>log group</em></p><p><em>A log stream</em> - entity, which records into particular log group</p><p><em>A log record</em> - is a single record of some event</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># log group operations</span>
aws logs create-log-group
aws logs delete-log-group
aws logs associate-kms-key

<span style=color:#75715e># log stream operations</span>
aws logs create-log-stream
aws logs delete-log-stream

<span style=color:#75715e># log record operations</span>
aws logs put-log-events
aws logs get-log-events
aws logs get-log-record
</code></pre></div><h3 id=intagration-with-another-services>Intagration with another services
<a class=anchor href=#intagration-with-another-services>#</a></h3><table><thead><tr><th>service</th><th>type of logs</th></tr></thead><tbody><tr><td>CloudTrail</td><td>itself logs</td></tr><tr><td>API Gateway</td><td>Access/Execution logs</td></tr><tr><td>ECS</td><td>Container logs</td></tr><tr><td>Lambda</td><td>Execution logs</td></tr><tr><td>RDS</td><td>DB logs</td></tr><tr><td>Systems Manager</td><td>Run</td></tr><tr><td>EC2</td><td>App/OS logs</td></tr></tbody></table><h3 id=cloudtrail>CloudTrail
<a class=anchor href=#cloudtrail>#</a></h3><ul><li>region scope</li><li>audit log</li><li>logs both success and failure</li><li>works with different types of events:<ul><li>management</li><li>data</li><li>insights</li></ul></li><li>organizations support</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># trail operations</span>
aws cloudtrail create-trail
aws cloudtrail delete-trail

<span style=color:#75715e># logging operations</span>
aws cloudtrail start-logging
aws cloudtrail stop-logging

<span style=color:#75715e># validation operations</span>
aws cloudtrail validate-logs
</code></pre></div><h2 id=analyzing-logs>Analyzing logs
<a class=anchor href=#analyzing-logs>#</a></h2><h3 id=cloudwatch-insights>CloudWatch insights
<a class=anchor href=#cloudwatch-insights>#</a></h3><ul><li>use existing log group/stream</li><li>(sql-like) query engine</li><li>alarm integration</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Create query</span>
aws logs put-query-definition
aws logs delete-query-definition

<span style=color:#75715e># execute query and get results</span>
aws logs start-query
aws logs stop-query
aws logs get-query
</code></pre></div><h3 id=cloudtrail-insights>CloudTrail insights
<a class=anchor href=#cloudtrail-insights>#</a></h3><ul><li>use existing events</li><li>ML-driven</li><li>no query engine</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>aws cloudtrail put-insights-selectors
aws cloudtrail get-insights-selectors
</code></pre></div><h3 id=elasticsearch-and-kibana>ElasticSearch and Kibana
<a class=anchor href=#elasticsearch-and-kibana>#</a></h3><ul><li>region scope</li><li>analytics engine</li><li>reporting engine</li><li>CWL integration</li></ul><h2 id=exporting-logs>Exporting logs
<a class=anchor href=#exporting-logs>#</a></h2><h3 id=cwl-export>CWL export
<a class=anchor href=#cwl-export>#</a></h3><ul><li>S3 export</li><li>CLI tail</li><li>subscription filter - automatically delivers logs from CW to tne another service:<ul><li>kinesis stream</li><li>lambda function</li><li>kinesis data firehose</li><li>logical destination</li></ul></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># create or delete export task</span>
aws logs create-export-task
aws logs cancel-export-task

<span style=color:#75715e># live tail of log stream</span>
aws logs tail

<span style=color:#75715e># create new subscription filter</span>
aws logs put-subscription-filter
  --log-group-name
  --filter-name
  --filter-pattern
  --destination-arn
  --role-arn
</code></pre></div><h3 id=kinesis-data-firehose>Kinesis data firehose
<a class=anchor href=#kinesis-data-firehose>#</a></h3><p>This is a sort of batch mechanism</p><ul><li>region scope</li><li>streaming pipeline</li><li>buffer and batch</li></ul><p>Possible destinations:</p><ul><li>S3</li><li>Redshift</li><li>ES</li><li>HTTP endpoint</li><li>Datadog</li><li>MongoDB</li><li>New Relic</li><li>Splunk</li></ul><p>Kinesis Firehose delivery to S3:</p><p><img src=/kinesis_firehose_delivery_to_s3.png alt></p><h2 id=cloudwatch-alarm>CloudWatch Alarm
<a class=anchor href=#cloudwatch-alarm>#</a></h2><h3 id=terms>Terms
<a class=anchor href=#terms>#</a></h3><p><em>Period</em> - length of time evaluate metric or expression to create an individual data point</p><p><em>Evaluation Perion</em> - number of data points to evaluate when determining alarm state</p><p><em>Datapionts to Alarm</em> - number of data points within evaluation period that must be breaching to cause ALARM state. Does not have to be consecutive.</p><p><em>Evaluation range</em> - number of data points retrieved by CW for alarm evaluation. Greater than Evaluation Period but varies.</p><h3 id=missing-data-points>Missing data points
<a class=anchor href=#missing-data-points>#</a></h3><ul><li>missing - alarm doesn&rsquo;t consider messing data points at all</li><li>notBreaching - missing data points treated as being within threshold</li><li>breaching - missing data points treated as breaching threshold</li><li>ignore - current alarm state is maintained</li></ul><h3 id=other-alarms-options>Other alarms options
<a class=anchor href=#other-alarms-options>#</a></h3><ul><li>high resolution alarm - period less than 1 minute</li><li>math expression alarm - combine up to 10 metrics</li><li>percentile alarm - percentile as monitored statistics</li><li>anomaly detection alarm - use standard deviation</li><li>composite alarm - combine alarm state of other alarms</li></ul><h3 id=alarm-actions>alarm actions
<a class=anchor href=#alarm-actions>#</a></h3><ul><li>SNS topic:<ul><li>email</li><li>sms</li><li>Lambda</li><li>etc</li></ul></li><li>EC2 actions:<ul><li>stop</li><li>reboot</li><li>terminate</li><li>recover</li></ul></li><li>Auto Scaling action</li><li>Systems Manager (SSM) OpsItem</li></ul><h2 id=cloudwatch-metric-filters>CloudWatch Metric Filters
<a class=anchor href=#cloudwatch-metric-filters>#</a></h2><p>You can create a metric from a string with Metric Filters.</p><h3 id=string-metric-filters-basics>String Metric Filters basics
<a class=anchor href=#string-metric-filters-basics>#</a></h3><ul><li>match everything - <code>""</code></li><li>single term - <code>"ERROR"</code></li><li>include/exclude terms - <code>"ERROR" - "permissions"</code> // will exclude all strings, which contains &ldquo;permissions&rdquo;</li><li>multiple terms using AND - <code>"ERROR memory exceprion"</code></li><li>multiple terms using OR - <code>?ERROR ?WARN</code></li></ul><h3 id=space-delimited-metric-filter-basics>Space-delimited metric filter basics
<a class=anchor href=#space-delimited-metric-filter-basics>#</a></h3><ul><li>specify all fields with a name, bounded by <code>[]</code> and separated by commas</li><li>specify unknown number of fields with <code>"..."</code></li><li>add conditions: <code>=, !=, &lt;, &lt;=, >, >=</code></li><li>utilize <code>*</code> to match partial string or numbers</li><li>implement AND with <code>&&</code> and OR with <code>||</code></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># filter examples with Apache log

# match all 4XX response codes
[ip, id, user, timestamp, request, status_code = 4*, size]

# match response size &gt; 1000 bytes
[ip, id, user, timestamp, request, status_code, size &gt; 1000]

# ignore all redirect response codes
[ip, id, user, timestamp, request, status_code != 3*, size]
</code></pre></div><h3 id=json-metric-filter-basics>JSON metric filter basics
<a class=anchor href=#json-metric-filter-basics>#</a></h3><ul><li><code>{SELECTOR EQUALITY_OPERATOR STRING}</code><ul><li>EQUALITY_OPERATOR is <code>=</code> or <code>!=</code></li></ul></li><li><code>{SELECTOR NUMERIC_OPERATOR NUMBER}</code><ul><li>NUMERIC_OPERATOR can be <code>=</code>, <code>!=</code>, <code>&lt;</code>, <code>></code>, <code>&lt;=</code>, <code>>=</code></li></ul></li><li>SELECTOR starts with <code>$</code>, indicating the root of JSON<ul><li>SELECTOR supports arrays</li><li>implement AND with <code>&&</code> and OR with <code>||</code></li><li>publish numerical value using <code>"metricValue:"</code></li></ul></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#960050;background-color:#1e0010>filter</span> <span style=color:#960050;background-color:#1e0010>example</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>CloudTrail</span> <span style=color:#960050;background-color:#1e0010>log</span>

<span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#960050;background-color:#1e0010>match</span> <span style=color:#960050;background-color:#1e0010>all</span> <span style=color:#960050;background-color:#1e0010>console</span> <span style=color:#960050;background-color:#1e0010>login</span> <span style=color:#960050;background-color:#1e0010>failures</span>
{ <span style=color:#960050;background-color:#1e0010>($.eventName</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#960050;background-color:#1e0010>ConsoleLogin)</span> <span style=color:#960050;background-color:#1e0010>&amp;&amp;</span> <span style=color:#960050;background-color:#1e0010>($.responseElements.ConsoleLogin</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#f92672>&#34;Failure&#34;</span><span style=color:#960050;background-color:#1e0010>)</span> }

<span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#960050;background-color:#1e0010>match</span> <span style=color:#960050;background-color:#1e0010>all</span> <span style=color:#960050;background-color:#1e0010>console</span> <span style=color:#960050;background-color:#1e0010>logins</span> <span style=color:#960050;background-color:#1e0010>by</span> <span style=color:#960050;background-color:#1e0010>IAM</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>john.doe</span>
{ <span style=color:#960050;background-color:#1e0010>($.eventName</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#960050;background-color:#1e0010>ConsoleLogin)</span> <span style=color:#960050;background-color:#1e0010>&amp;&amp;</span> <span style=color:#960050;background-color:#1e0010>($.userIdentity.userName</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#f92672>&#34;john.doe&#34;</span><span style=color:#960050;background-color:#1e0010>)</span> }

<span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#960050;background-color:#1e0010>match</span> <span style=color:#960050;background-color:#1e0010>all</span> <span style=color:#960050;background-color:#1e0010>root</span> <span style=color:#960050;background-color:#1e0010>user</span> <span style=color:#960050;background-color:#1e0010>activity</span>
{ <span style=color:#960050;background-color:#1e0010>$.userIdentiry.type</span> <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#f92672>&#34;Root&#34;</span> <span style=color:#960050;background-color:#1e0010>&amp;&amp;</span> <span style=color:#960050;background-color:#1e0010>$.userIdentity.invokeBy</span> <span style=color:#960050;background-color:#1e0010>NOT</span> <span style=color:#960050;background-color:#1e0010>EXISTS</span> <span style=color:#960050;background-color:#1e0010>&amp;&amp;</span> <span style=color:#960050;background-color:#1e0010>$.eventType</span> <span style=color:#960050;background-color:#1e0010>!=</span> <span style=color:#e6db74>&#34;AwsServiceEvent&#34;</span> }
</code></pre></div><h2 id=cloudwatch-dashboards>CloudWatch Dashboards
<a class=anchor href=#cloudwatch-dashboards>#</a></h2><p>Dashboard sharing:</p><ul><li>enable in settings</li><li>share with specific IAM user(s)</li><li>share publicly</li><li>share via SSO</li><li>share logs widgets</li></ul><h2 id=cloudwatch-alarm-remediation>CloudWatch alarm remediation
<a class=anchor href=#cloudwatch-alarm-remediation>#</a></h2><h3 id=ec2-actions>EC2 actions
<a class=anchor href=#ec2-actions>#</a></h3><p><img src=/cw_alarm_remediation_ec2_actions.drawio.png alt></p><p><em>recover</em> action mya be used only if underline HW has failed. It allows to move instance to the another HW. Also:</p><ul><li>certain instance types</li><li>VPC only</li><li>default or dedicated tenance</li><li>no instance store</li></ul><h3 id=autoscaling-actions>Autoscaling actions
<a class=anchor href=#autoscaling-actions>#</a></h3><p><img src=/cw_alarm_remediation_autoscaling_actions.drawio.png alt></p><h3 id=manual-actions>Manual actions
<a class=anchor href=#manual-actions>#</a></h3><p>If we recieve notification from CW alarm, we can fix the issue manually with AWS console or cli.</p><ul><li>performance metrics:<ul><li>scale horiaontally</li><li>scale vertically</li></ul></li><li>availability metrics:<ul><li>restore</li><li>recover</li><li>fail over</li></ul></li></ul><h3 id=automated-actions>Automated actions
<a class=anchor href=#automated-actions>#</a></h3><p>An SNS topik can trigger:</p><ul><li>custom endpoint (with any lind of script)</li><li>Lambda funcition via API Gateway</li><li>Lambda function directly</li></ul><h3 id=ec2-status-checks>EC2 status checks
<a class=anchor href=#ec2-status-checks>#</a></h3><ul><li>System reachability - represents host OS and hardware layer</li><li>Instance reachability - represents guest OS and processes</li></ul><h3 id=ebs-volume-status-checks>EBS volume status checks
<a class=anchor href=#ebs-volume-status-checks>#</a></h3><ul><li>if volume NOT provision IOPs:<ul><li>ok</li><li>warning</li><li>impaired</li><li>insufficient data</li></ul></li><li>in other case:<ul><li>Normal</li><li>Degreded</li><li>Stalled</li><li>insufficient data</li></ul></li></ul><h2 id=eventbridge-rules>EventBridge rules
<a class=anchor href=#eventbridge-rules>#</a></h2><p>EventBridge basics</p><ul><li>region based</li><li>default event bus</li><li>custom event bus</li><li>sources and targets</li><li>replay feature</li><li>DLQ feature</li></ul><p>Sources:</p><ul><li>CloudTrail API events</li><li>GuardDuty findings</li><li>Other service events</li><li>Forwarded events</li><li>Scheduled events</li></ul><p>Rules is a JSON format match event properties:</p><ul><li>API gateway</li><li>CW logs</li><li>EC2 actions</li><li>Remote event bus</li><li>Lambda function</li><li>SNS topic</li></ul><p>Patterns:</p><ul><li>event</li><li>schedule</li></ul><h2 id=config-rules-and-ssm-automation-documents>Config rules and SSM automation documents
<a class=anchor href=#config-rules-and-ssm-automation-documents>#</a></h2><p>Config basics</p><ul><li>region scope</li><li>config streams</li><li>partial coverage</li><li>capture changes</li><li>capture config</li><li>snapshots</li></ul><p>Config rule creation example</p><p>We have EC2 instance and AWS config. The last one will capture any changes in instance&rsquo;s properties via config stream.</p><p>You can react for these changes via:</p><ul><li>AWS managed rules (for specific changes)</li><li>custom rules via Lambda function</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#collecting-logs>Collecting logs</a><ul><li><a href=#cloudwatch>CloudWatch</a></li><li><a href=#intagration-with-another-services>Intagration with another services</a></li><li><a href=#cloudtrail>CloudTrail</a></li></ul></li><li><a href=#analyzing-logs>Analyzing logs</a><ul><li><a href=#cloudwatch-insights>CloudWatch insights</a></li><li><a href=#cloudtrail-insights>CloudTrail insights</a></li><li><a href=#elasticsearch-and-kibana>ElasticSearch and Kibana</a></li></ul></li><li><a href=#exporting-logs>Exporting logs</a><ul><li><a href=#cwl-export>CWL export</a></li><li><a href=#kinesis-data-firehose>Kinesis data firehose</a></li></ul></li><li><a href=#cloudwatch-alarm>CloudWatch Alarm</a><ul><li><a href=#terms>Terms</a></li><li><a href=#missing-data-points>Missing data points</a></li><li><a href=#other-alarms-options>Other alarms options</a></li><li><a href=#alarm-actions>alarm actions</a></li></ul></li><li><a href=#cloudwatch-metric-filters>CloudWatch Metric Filters</a><ul><li><a href=#string-metric-filters-basics>String Metric Filters basics</a></li><li><a href=#space-delimited-metric-filter-basics>Space-delimited metric filter basics</a></li><li><a href=#json-metric-filter-basics>JSON metric filter basics</a></li></ul></li><li><a href=#cloudwatch-dashboards>CloudWatch Dashboards</a></li><li><a href=#cloudwatch-alarm-remediation>CloudWatch alarm remediation</a><ul><li><a href=#ec2-actions>EC2 actions</a></li><li><a href=#autoscaling-actions>Autoscaling actions</a></li><li><a href=#manual-actions>Manual actions</a></li><li><a href=#automated-actions>Automated actions</a></li><li><a href=#ec2-status-checks>EC2 status checks</a></li><li><a href=#ebs-volume-status-checks>EBS volume status checks</a></li></ul></li><li><a href=#eventbridge-rules>EventBridge rules</a></li><li><a href=#config-rules-and-ssm-automation-documents>Config rules and SSM automation documents</a></li></ul></nav></aside></main></body></html>